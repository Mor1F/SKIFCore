<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKIFVault</title>
    
	<link rel="icon" sizes="16x16" href="img/favicon-vault/favicon-16x16.png">
	<link rel="icon" sizes="32x32" href="img/favicon-vault/favicon-32x32.png">
	<link rel="icon" sizes="48x48" href="img/favicon-vault/favicon-48x48.png">
	<link rel="icon" sizes="96x96" href="img/favicon-vault/favicon-96x96.png">

	<link rel="apple-touch-icon" sizes="180x180" href="img/favicon-vault/apple-touch-icon.png">
	<link rel="manifest" href="img/favicon-vault/site.webmanifest">

	<meta name="application-name" content="SKIFVault">
	<meta name="apple-mobile-web-app-title" content="SKIFVault">
	<meta name="theme-color" content="#050505">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Unbounded:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body class="dark-mode locked">

    <!-- Живой фон -->
    <div class="ambient-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <!-- ЭКРАН БЛОКИРОВКИ -->
    <div id="lockScreen" class="lock-screen">
        <div class="lock-card glass">
            <div class="lock-icon-box">
                <i class="fa-solid fa-fingerprint"></i>
            </div>
            <h2 id="lockTitle">Подключение...</h2>
            <p id="lockMessage" class="lock-desc">Инициализация</p>
            
            <!-- Вход -->
            <div class="lock-input-wrapper" id="loginForm">
                <input type="password" id="pinInput" placeholder="Мастер-пароль" autocomplete="off">
                <button class="btn-unlock" onclick="unlockVault()">
                    <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>

            <!-- Регистрация (Скрыто) -->
            <div id="setupForm" style="display:none; width: 100%;">
                <div class="lock-input-wrapper">
                    <input type="password" id="setupPass" placeholder="Новый пароль" autocomplete="off">
                </div>
                <div class="lock-input-wrapper">
                    <input type="password" id="setupPhrase" placeholder="Кодовая фраза (для сброса)" autocomplete="off">
                </div>
                <button class="btn-primary full-width" onclick="initVaultOnServer()">Создать базу</button>
            </div>

            <div class="lock-footer">
                <button class="btn-text danger" onclick="promptReset()">Сброс (Kill Switch)</button>
            </div>
        </div>
    </div>

    <!-- ИНТЕРФЕЙС ПРИЛОЖЕНИЯ -->
    <div class="app-layout" id="appInterface">
        
        <!-- SIDEBAR -->
        <aside class="sidebar glass">
            <div class="brand">
                <div class="logo-mark"><i class="fa-solid fa-layer-group"></i></div>
                <div class="logo-text">SKIF<span>Vault</span></div>
            </div>

            <div class="nav-wrapper">
                <div class="nav-header">
                    <span>Структура</span>
                    <button class="icon-btn-mini" onclick="toggleSortMode()" id="btnSort" title="Сортировка">
                        <i class="fa-solid fa-sort"></i>
                    </button>
                </div>
                <div id="categoryContainer" class="category-tree"></div>
            </div>

            <div class="sidebar-footer">
                <button class="btn-sidebar-main" onclick="openCatModal()">
                    <i class="fa-solid fa-folder-plus"></i> Группа
                </button>
                <button class="btn-sidebar-icon" onclick="lockVault()" title="Заблокировать">
                    <i class="fa-solid fa-lock"></i>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <header class="header glass">
                <div class="header-left">
                     <!-- Кнопка Назад на главную -->
                    <a href="/" class="back-btn" title="На главную">
                        <i class="fa-solid fa-chevron-left"></i>
                    </a>
                    
                    <div class="search-wrapper">
                        <i class="fa-solid fa-search search-icon"></i>
                        <input type="text" id="searchInput" placeholder="Поиск записей...">
                    </div>
                </div>

                <div class="header-actions">
                    <!-- Кнопка Темы убрана, т.к. стиль единый темный -->
                    <button class="action-btn" onclick="exportData()" title="Экспорт JSON">
                        <i class="fa-solid fa-download"></i>
                    </button>
                    <button class="action-btn" onclick="document.getElementById('importFile').click()" title="Импорт JSON">
                        <i class="fa-solid fa-upload"></i>
                    </button>
                    <input type="file" id="importFile" hidden onchange="importData(this)">
                    
                    <button class="btn-primary" onclick="openItemModal()">
                        <i class="fa-solid fa-plus"></i> Запись
                    </button>
                </div>
            </header>

            <div class="scroll-container">
                <div class="cards-grid" id="itemsGrid"></div>
            </div>
        </main>
    </div>

	<!-- MODAL: CATEGORY -->
    <div class="overlay" id="catModal">
        <div class="modal glass">
            <div class="modal-header">
                <h3 id="catModalTitle">Категория</h3>
                <button class="close-btn" onclick="closeModal('catModal')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editCatId">
                
                <div class="form-group">
                    <label>Название</label>
                    <input type="text" id="catName" placeholder="Например: Linux">
                </div>

                <div class="form-group">
                    <label>Расположение (Родитель)</label>
                    <select id="catParent">
                        <option value="root">-- Корневой уровень --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Внешний вид</label>
                    <!-- Переключатель типов -->
                    <div class="tab-switcher">
                        <button class="tab-btn active" onclick="switchIconTab('icon')">FontAwesome</button>
                        <button class="tab-btn" onclick="switchIconTab('img')">Файл (SVG/PNG)</button>
                    </div>
                    <input type="hidden" id="catIconType" value="icon">
                    
                    <!-- Поле для FontAwesome -->
                    <div id="tabIconInput" class="tab-content active">
                        <input type="text" id="catIconClass" placeholder="fa-solid fa-server">
                        <small style="color: var(--text-secondary); font-size: 10px; margin-top: 4px; display: block;">Пример: fa-solid fa-database</small>
                    </div>
                    
                    <!-- Поле для Файла -->
                    <div id="tabImgInput" class="tab-content">
                        <input type="text" id="catImgName" placeholder="icon.svg">
                        <small style="color: var(--text-secondary); font-size: 10px; margin-top: 4px; display: block;">Файл должен лежать в папке /img/</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-text delete" onclick="deleteCurrentCategory()" id="btnDeleteCat" style="display:none">Удалить</button>
                <div class="spacer"></div>
                <button class="btn-text" onclick="closeModal('catModal')">Отмена</button>
                <button class="btn-primary" onclick="saveCategory()">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- MODAL: ITEM -->
    <div class="overlay" id="itemModal">
        <div class="modal glass large">
            <div class="modal-header">
                <h3 id="itemModalTitle">Запись</h3>
                <button class="close-btn" onclick="closeModal('itemModal')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editItemId">
                <div class="form-group">
                    <label>Заголовок</label>
                    <input type="text" id="itemTitle" placeholder="Описание...">
                </div>
                <div class="form-group">
                    <label>Данные</label>
                    <textarea id="itemCommand" rows="12" placeholder="Пароль, код, ключ или заметка..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-text" onclick="closeModal('itemModal')">Отмена</button>
                <button class="btn-primary" onclick="saveItem()">Сохранить</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"><i class="fa-solid fa-check"></i> Скопировано</div>

    <script src="script.js"></script>
</body>
</html>